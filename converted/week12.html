<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Week 12</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body class="week-content">
    <h1>Week 12</h1>
    <p>238W1A1290</p>
    <p>WEEK-12</p>
    <p>SPRING JPA WITH RELATIONAL DATABASE</p>
    <p>Dependencies:  Spring web, Spring data jpa  and mysql drver</p>
    <p>application.properties</p>
    <p>spring.application.name=jpamysql</p>
    <p>server.port=88</p>
    <p>&nbsp;</p>
    <p># JDBC - change user/password/db name as needed</p>
    <p>spring.datasource.url=jdbc:mysql://localhost:3306/employee_db?useSSL=false&amp;allowPublicKeyRetrieval=true&amp;serverTimezone=UTC</p>
    <p>spring.datasource.username=root</p>
    <p>spring.datasource.password=</p>
    <p>spring.datasource.driver-class-name=com.mysql.jdbc.Driver</p>
    <p>&nbsp;</p>
    <p># JPA / Hibernate</p>
    <p>spring.jpa.hibernate.ddl-auto=update</p>
    <p>spring.jpa.show-sql=true</p>
    <p>&nbsp;</p>
    <p>spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect</p>
    <p>&nbsp;</p>
    <p>2.  Create database + sample data (run in MySQL)</p>
    <p>CREATE DATABASE IF NOT EXISTS testdb;</p>
    <p>USE employee_db;</p>
    <p>&nbsp;</p>
    <p>CREATE TABLE IF NOT EXISTS employee (</p>
    <p>  id INT PRIMARY KEY AUTO_INCREMENT,</p>
    <p>  name VARCHAR(100),</p>
    <p>  department VARCHAR(100)</p>
    <p>);</p>
    <p>&nbsp;</p>
    <p>INSERT INTO employee (name, department) VALUES</p>
    <p>(&#x27;Manogna&#x27;,&#x27;IT&#x27;),</p>
    <p>(&#x27;Keerthi&#x27;,&#x27;CSE&#x27;),</p>
    <p>(&#x27;Sai&#x27;,&#x27;ECE&#x27;);</p>
    <p>&nbsp;</p>
    <p>3) Entity — Employee.java</p>
    <p>src/main/java/com/example/demo/Employee.java</p>
    <p>package com.example.demo;</p>
    <p>&nbsp;</p>
    <p>import jakarta.persistence.Entity;</p>
    <p>import jakarta.persistence.GeneratedValue;</p>
    <p>import jakarta.persistence.GenerationType;</p>
    <p>import jakarta.persistence.Id;</p>
    <p>&nbsp;</p>
    <p>@Entity</p>
    <p>public class Employee {</p>
    <p>&nbsp;</p>
    <p>    @Id</p>
    <p>    @GeneratedValue(strategy = GenerationType.IDENTITY)</p>
    <p>    private Integer id;</p>
    <p>&nbsp;</p>
    <p>    private String name;</p>
    <p>    private String department;</p>
    <p>&nbsp;</p>
    <p>    public Employee() {}</p>
    <p>&nbsp;</p>
    <p>    public Employee(String name, String department) {</p>
    <p>        this.name = name;</p>
    <p>        this.department = department;</p>
    <p>    }</p>
    <p>&nbsp;</p>
    <p>    // getters and setters — required for Jackson / JPA</p>
    <p>    public Integer getId() { return id; }</p>
    <p>    public void setId(Integer id) { this.id = id; }</p>
    <p>&nbsp;</p>
    <p>    public String getName() { return name; }</p>
    <p>    public void setName(String name) { this.name = name; }</p>
    <p>&nbsp;</p>
    <p>    public String getDepartment() { return department; }</p>
    <p>    public void setDepartment(String department) { this.department = department; }</p>
    <p>}</p>
    <p>&nbsp;</p>
    <p>4) Repository — EmployeeRepository.java</p>
    <p>src/main/java/com/example/demo/EmployeeRepository.java</p>
    <p>package com.example.demo;</p>
    <p>&nbsp;</p>
    <p>import org.springframework.data.jpa.repository.JpaRepository;</p>
    <p>&nbsp;</p>
    <p>public interface EmployeeRepository extends JpaRepository&lt;Employee, Integer&gt; { }</p>
    <p>&nbsp;</p>
    <p>5) Controller — returns JSON and HTML view</p>
    <p>src/main/java/com/example/demo/EmployeeController.java</p>
    <p>package com.example.demo;</p>
    <p>&nbsp;</p>
    <p>import org.springframework.beans.factory.annotation.Autowired;</p>
    <p>import org.springframework.stereotype.Controller;</p>
    <p>import org.springframework.ui.Model;</p>
    <p>import org.springframework.web.bind.annotation.GetMapping;</p>
    <p>import org.springframework.web.bind.annotation.RequestMapping;</p>
    <p>import org.springframework.web.bind.annotation.RestController;</p>
    <p>&nbsp;</p>
    <p>import java.util.List;</p>
    <p>&nbsp;</p>
    <p>// REST endpoints</p>
    <p>@RestController</p>
    <p>@RequestMapping(&quot;/api&quot;)</p>
    <p>class EmployeeRestController {</p>
    <p>    @Autowired</p>
    <p>    private EmployeeRepository repo;</p>
    <p>&nbsp;</p>
    <p>    @GetMapping(&quot;/employees&quot;)</p>
    <p>    public List&lt;Employee&gt; getAll() {</p>
    <p>        return repo.findAll();</p>
    <p>    }</p>
    <p>}</p>
    <p>&nbsp;</p>
    <p>// HTML (Thymeleaf) controller</p>
    <p>@Controller</p>
    <p>class EmployeeViewController {</p>
    <p>    @Autowired</p>
    <p>    private EmployeeRepository repo;</p>
    <p>&nbsp;</p>
    <p>    @GetMapping(&quot;/employees&quot;)</p>
    <p>    public String employeesPage(Model model) {</p>
    <p>        model.addAttribute(&quot;employees&quot;, repo.findAll());</p>
    <p>        return &quot;employees&quot;;  // maps to src/main/resources/templates/employees.html</p>
    <p>    }</p>
    <p>}</p>
    <p>Note: we used two controllers — one @RestController for JSON (/api/employees) and one @Controller for HTML (/employees). They can coexist.</p>
    <p>&nbsp;</p>
    <p>6) Thymeleaf template — employees.html</p>
    <p>Create file: src/main/resources/templates/employees.html</p>
    <p>&lt;!DOCTYPE html&gt;</p>
    <p>&lt;html xmlns:th=&quot;http://www.thymeleaf.org&quot;&gt;</p>
    <p>&lt;head&gt;</p>
    <p>    &lt;meta charset=&quot;UTF-8&quot;/&gt;</p>
    <p>    &lt;title&gt;Employees&lt;/title&gt;</p>
    <p>    &lt;style&gt;</p>
    <p>      table { border-collapse: collapse; width: 70%; margin-top: 20px; }</p>
    <p>      th, td { border: 1px solid #333; padding: 8px; text-align: left; }</p>
    <p>      th { background: #efefef; }</p>
    <p>    &lt;/style&gt;</p>
    <p>&lt;/head&gt;</p>
    <p>&lt;body&gt;</p>
    <p>  &lt;h2&gt;Employee List&lt;/h2&gt;</p>
    <p>  &lt;table&gt;</p>
    <p>    &lt;thead&gt;</p>
    <p>      &lt;tr&gt;&lt;th&gt;ID&lt;/th&gt;&lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Department&lt;/th&gt;&lt;/tr&gt;</p>
    <p>    &lt;/thead&gt;</p>
    <p>    &lt;tbody&gt;</p>
    <p>      &lt;tr th:each=&quot;e : ${employees}&quot;&gt;</p>
    <p>        &lt;td th:text=&quot;${e.id}&quot;&gt;1&lt;/td&gt;</p>
    <p>        &lt;td th:text=&quot;${e.name}&quot;&gt;Name&lt;/td&gt;</p>
    <p>        &lt;td th:text=&quot;${e.department}&quot;&gt;Dept&lt;/td&gt;</p>
    <p>      &lt;/tr&gt;</p>
    <p>    &lt;/tbody&gt;</p>
    <p>  &lt;/table&gt;</p>
    <p>&lt;/body&gt;</p>
    <p>&lt;/html&gt;</p>
    <p>&nbsp;</p>
    <p>7. pom.xml add these code</p>
    <p>&lt;dependency&gt;</p>
    <p>    &lt;groupId&gt;mysql&lt;/groupId&gt;</p>
    <p>    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</p>
    <p>    &lt;version&gt;5.1.49&lt;/version&gt;</p>
    <p>&lt;/dependency&gt;</p>
    <p>&nbsp;</p>
    <p>&lt;dependency&gt;</p>
    <p>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</p>
    <p>    &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;</p>
    <p>&lt;/dependency&gt;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>8) Run in STS</p>
    <p>Import project into STS (File → Import → Existing Maven Projects).</p>
    <p>Right-click project → Run As → Spring Boot App.</p>
    <p>Visit:</p>
    <p>HTML table: http://localhost:88/employees</p>
    <p>JSON API: </p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>2. Spring jpa with h2</p>
    <p>Project name: h2db-jpa</p>
    <p>Student.java:</p>
    <p>package com.example.mysqldemo;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>import jakarta.persistence.Entity;</p>
    <p>import jakarta.persistence.GeneratedValue;</p>
    <p>import jakarta.persistence.GenerationType;</p>
    <p>import jakarta.persistence.Id;</p>
    <p>&nbsp;</p>
    <p>@Entity</p>
    <p>public class Student {</p>
    <p>&nbsp;</p>
    <p>    @Id</p>
    <p>    @GeneratedValue(strategy = GenerationType.IDENTITY)</p>
    <p>    private Long id;</p>
    <p>&nbsp;</p>
    <p>    private String name;</p>
    <p>    private String city;</p>
    <p>&nbsp;</p>
    <p>    public Student() {}</p>
    <p>&nbsp;</p>
    <p>    public Student(String name, String city) {</p>
    <p>        this.name = name;</p>
    <p>        this.city = city;</p>
    <p>    }</p>
    <p>&nbsp;</p>
    <p>    public Long getId() {</p>
    <p>        return id;</p>
    <p>    }</p>
    <p>&nbsp;</p>
    <p>    public void setId(Long id) {</p>
    <p>        this.id = id;</p>
    <p>    }</p>
    <p>&nbsp;</p>
    <p>    public String getName() {</p>
    <p>        return name;</p>
    <p>    }</p>
    <p>&nbsp;</p>
    <p>    public void setName(String name) {</p>
    <p>        this.name = name;</p>
    <p>    }</p>
    <p>&nbsp;</p>
    <p>    public String getCity() {</p>
    <p>        return city;</p>
    <p>    }</p>
    <p>&nbsp;</p>
    <p>    public void setCity(String city) {</p>
    <p>        this.city = city;</p>
    <p>    }</p>
    <p>}</p>
    <p>&nbsp;</p>
    <p>Student Controller.java:</p>
    <p>package com.example.mysqldemo;</p>
    <p>&nbsp;</p>
    <p>import org.springframework.beans.factory.annotation.Autowired;</p>
    <p>import org.springframework.web.bind.annotation.*;</p>
    <p>&nbsp;</p>
    <p>import java.util.List;</p>
    <p>&nbsp;</p>
    <p>@RestController</p>
    <p>public class StudentController {</p>
    <p>&nbsp;</p>
    <p>    @Autowired</p>
    <p>    private StudentRepository repo;</p>
    <p>&nbsp;</p>
    <p>    @GetMapping(&quot;/&quot;)</p>
    <p>    public String home() {</p>
    <p>        return &quot;Spring Boot + H2 + JPA Example Running!&quot;;</p>
    <p>    }</p>
    <p>&nbsp;</p>
    <p>    @GetMapping(&quot;/add&quot;)</p>
    <p>    public String addStudent(@RequestParam String name,</p>
    <p>                             @RequestParam String city) {</p>
    <p>        repo.save(new Student(name, city));</p>
    <p>        return &quot;Student Added Successfully!&quot;;</p>
    <p>    }</p>
    <p>&nbsp;</p>
    <p>    @GetMapping(&quot;/students&quot;)</p>
    <p>    public List&lt;Student&gt; getStudents() {</p>
    <p>        return repo.findAll();</p>
    <p>    }</p>
    <p>}</p>
    <p>&nbsp;</p>
    <p>Student Repository.java:</p>
    <p>package com.example.mysqldemo;</p>
    <p>&nbsp;</p>
    <p>import org.springframework.data.jpa.repository.JpaRepository;</p>
    <p>&nbsp;</p>
    <p>public interface StudentRepository extends JpaRepository&lt;Student, Long&gt; {</p>
    <p>}</p>
    <p>&nbsp;</p>
    <p>Application.properties:</p>
    <p>spring.application.name=h2db-jpa</p>
    <p>spring.h2.console.enabled=true</p>
    <p>spring.h2.console.path=/h2-console</p>
    <p>spring.datasource.url=jdbc:h2:mem:testdb</p>
    <p>spring.datasource.driverClassName=org.h2.Driver</p>
    <p>spring.datasource.username=sa</p>
    <p>spring.datasource.password=</p>
    <p>spring.jpa.hibernate.ddl-auto=update</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
</body>
</html>